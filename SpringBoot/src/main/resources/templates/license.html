<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org/">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LICENSE</title>


<!-- Bootstrap & Icons -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<!-- Main Style -->
<link href="/css/style.css" rel="stylesheet">
  <!-- ì°¨íŠ¸ ë§í¬ -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* âœ… container ê°•ì œ í†µì¼ */
.container {
	max-width: 1440px !important;
	width: 100%;
	margin-left: auto;
	margin-right: auto;
	padding-left: 12px;
	padding-right: 12px;
	box-sizing: border-box;
}
</style>
</head>

<body>
 
	<!-- Header -->
	<input type="hidden" id="id" th:if="${member != null}"
		th:value="${member.id}" />

	<nav class="custom-header">
		<div
			class="container d-flex justify-content-between align-items-center">
			<div class="logo d-flex align-items-center gap-2">
				<a href="/"> <img src="/images/ë¡œê³ .png" height="40" alt="ë¡œê³ ">
					<span class="logo-text"></span>
				</a>
			</div>
			<div class="header-links d-flex gap-2">
				<a href="mypage" class="btn btn-outline-secondary">MYPAGE</a>
				<form th:action="@{/logout}" method="post" class="d-inline">
					<input type="hidden" th:name="${_csrf.parameterName}"
						th:value="${_csrf.token}" />
					<button type="submit" class="btn btn-outline-danger">LOGOUT</button>
				</form>

			</div>
		</div>
	</nav>


<div class="container mb-4 mt-4">
  <div class="dashboard-card p-4 w-100 d-flex justify-content-center flex-wrap">

    <!-- âœ… ì‹œí—˜ í’€ê¸° -->
    <div class="feature-card flex-fill  mb-3" style="min-width: 300px;">
      <div class="icon-box"><i class="bi bi-pencil-square"></i></div>
      <div class="feature-title">ì‹œí—˜ í’€ê¸°</div>
      <div class="feature-desc">ì›í•˜ëŠ” íšŒì°¨ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì‹œí—˜ì„ í’€ì–´ë³´ì„¸ìš”.</div>

      <form method="post" action="/goTest.do">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="liIdx" th:value="${licenseList[0].liIdx}" />
        <input type="hidden" name="liName" th:value="${licenseList[0].liName}" />
        <input type="hidden" name="liTime" th:value="${licenseList[0].liTime}" />
        <input type="hidden" name="liPbc" th:value="${licenseList[0].liPbc}" />
        <input type="hidden" name="liChap1" th:value="${licenseList[0].liChap1}" />
        <input type="hidden" name="liChap2" th:value="${licenseList[0].liChap2}" />
        <input type="hidden" name="liChap3" th:value="${licenseList[0].liChap3}" />
        <input type="hidden" name="liChap4" th:value="${licenseList[0].liChap4}" />
        <input type="hidden" name="liChap5" th:value="${licenseList[0].liChap5}" />
        <input type="hidden" name="liChap6" th:value="${licenseList[0].liChap6}" />

        <div class="mt-3">
          <select id="test-category" name="category" class="form-select">
            <option value="defult" disabled selected hidden>íšŒì°¨ ì„ íƒ</option>
            <option value="0">ëœë¤ ë¬¸ì œ</option>
            <th:block th:each="round : ${rounds}">
              <option th:value="${round[2]}" th:text="${round[0] + 'ë…„ ' + round[1] + 'íšŒ'}"></option>
            </th:block>
          </select>
          <div class="mt-3">
            <button class="btn btn-outline-primary" type="submit"
              onclick="if(document.getElementById('test-category').value == 'defult') { alert('íšŒì°¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return false; }">
              ì‹œí—˜ ë³´ëŸ¬ê°€ê¸°<i class="bi bi-arrow-right"></i>
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- âœ… ê¸°ì¶œ í’€ê¸° -->
    <div class="feature-card flex-fill mb-3" style="min-width: 300px;">
      <div class="icon-box"><i class="bi bi-journal-text"></i></div>
      <div class="feature-title">ê¸°ì¶œ í’€ê¸°</div>
      <div class="feature-desc">ì´ì „ ê¸°ì¶œ ë¬¸ì œë¥¼ ê²€ìƒ‰í•˜ê³  ë³µìŠµí•˜ì„¸ìš”.</div>

      <form method="post" action="/goPast.do">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="liIdx" th:value="${licenseList[0].liIdx}" />
        <input type="hidden" name="liName" th:value="${licenseList[0].liName}" />
        <input type="hidden" name="liTime" th:value="${licenseList[0].liTime}" />
        <input type="hidden" name="liPbc" th:value="${licenseList[0].liPbc}" />
        <input type="hidden" name="liChap1" th:value="${licenseList[0].liChap1}" />
        <input type="hidden" name="liChap2" th:value="${licenseList[0].liChap2}" />
        <input type="hidden" name="liChap3" th:value="${licenseList[0].liChap3}" />
        <input type="hidden" name="liChap4" th:value="${licenseList[0].liChap4}" />
        <input type="hidden" name="liChap5" th:value="${licenseList[0].liChap5}" />
        <input type="hidden" name="liChap6" th:value="${licenseList[0].liChap6}" />

        <div class="mt-3">
          <select id="past-category" name="category" class="form-select">
            <option value="default" disabled selected hidden>íšŒì°¨ ì„ íƒ</option>
            <th:block th:each="round : ${rounds}">
              <option th:value="${round[2]}" th:text="${round[0] + 'ë…„ ' + round[1] + 'íšŒ'}"></option>
            </th:block>
          </select>
          <div class="mt-3">
            <button class="btn btn-outline-primary" type="submit"
              onclick="if(document.getElementById('past-category').value == 'default') { alert('íšŒì°¨ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return false; }">
              ê¸°ì¶œ ë³´ê¸°<i class="bi bi-arrow-right"></i>
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- âœ… ì£¼ì œë³„ í•™ìŠµí•˜ê¸° -->
    <div class="feature-card flex-fill mb-3" style="min-width: 300px;">
      <div class="icon-box"><i class="bi bi-layers"></i></div>
      <div class="feature-title">ì£¼ì œë³„ í•™ìŠµí•˜ê¸°</div>
      <div class="feature-desc">ìœ í˜•ì„ ì„ íƒí•´ì„œ ì§‘ì¤‘ì ìœ¼ë¡œ í•™ìŠµí•´ë³´ì„¸ìš”.</div>

      <form method="post" action="/goTopic.do">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="liIdx" th:value="${licenseList[0].liIdx}" />
        <div class="mt-3">
          <select id="topic-category" name="category" class="form-select">
            <option value="default" disabled selected hidden>ìœ í˜• ì„ íƒ</option>
          </select>
          <div class="mt-3">
            <button class="btn btn-outline-primary" type="submit"
              onclick="if(document.getElementById('topic-category').value == 'default') { alert('ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return false; }">
              í•™ìŠµ ì‹œì‘í•˜ê¸°<i class="bi bi-arrow-right"></i>
            </button>
          </div>
        </div>
      </form>
    </div>

  </div>
</div>

  
<div class="container mb-5">
  <!-- âœ… 1. ì¹´ë“œ ì „ì²´ë¥¼ flexë¡œ -->
  <div class="dashboard-card p-4 w-100 d-flex flex-wrap" style="min-height: 300px;">

    <!-- âœ… ì™¼ìª½: ì°¨íŠ¸ ì˜ì—­ (40%) -->
    <div style="flex: 1 1 40%; max-width: 40%; padding-right: 1rem;">
      <h5 class="fw-bold mb-3"
          th:if="${member != null}"
          th:text="${member.name} + 'ë‹˜ì˜ ì£¼ì œë³„ ì˜¤ë‹µ TOP 5'">
      </h5>
      <!-- âœ… canvas í¬ê¸° ê°•ì œ ì œí•œ -->
      <div id="topicChartDiv" style="display:none;"><canvas id="topicChart" style="width: 100%; height: 300px; max-width: 100%;"></canvas></div>
      <div id="topicChartMessage"></div>
    </div>

    <!-- âœ… ì˜¤ë¥¸ìª½: subjectScore ì˜ì—­ (60%) -->
    <div style="flex: 1 1 60%; max-width: 60%; padding-left: 1rem;">
      <h5 class="fw-bold mb-3"
          th:if="${member != null}"
          th:text="${member.name} + 'ë‹˜ì˜ ê³¼ëª©ë³„ ìµœê·¼ 3íšŒì°¨'">
      </h5>
      <div id="subjectScore"></div>
    </div>
  </div>
</div>



  <!-- Calendar & Schedule -->
<div class="container mb-6">
  <div class="row">
    <div class="col-md-8 mb-4">
      <div class="calendar-box">
        <h4 class="d-flex flex-wrap align-items-center mb-3">
          <button class="btn btn-outline-secondary btn-sm me-2" onclick="changeMonth(-1)">â†</button>
          <span id="month-year" class="fw-bold me-3"></span>
          <button class="btn btn-outline-secondary btn-sm me-2" onclick="changeMonth(1)">â†’</button>

          <!-- âœ… ë²”ë¡€ ì‚½ì… -->
          <div class="calendar-legend d-flex justify-content-center align-items-center gap-3 flex-wrap ms-3 me-auto">
            <div class="legend-item d-flex align-items-center gap-1">
              <div class="legend-color apply"></div>
              <span class="small">ì ‘ìˆ˜</span>
            </div>
            <div class="legend-item d-flex align-items-center gap-1">
              <div class="legend-color exam"></div>
              <span class="small">ì‹œí—˜</span>
            </div>
            <div class="legend-item d-flex align-items-center gap-1">
              <div class="legend-color result"></div>
              <span class="small">ê²°ê³¼</span>
            </div>
          </div>

          <!-- âœ… ì¶œì„ ë²„íŠ¼ ì˜¤ë¥¸ìª½ ì •ë ¬ -->
          <button class="btn btn-primary rounded-pill px-3 ms-auto" style="margin-right: 40px;" type="button" id="check-attendance">ì¶œì„</button>
        </h4>

        <table>
          <thead>
            <tr>
              <th style="color: red;">ì¼</th>
              <th>ì›”</th>
              <th>í™”</th>
              <th>ìˆ˜</th>
              <th>ëª©</th>
              <th>ê¸ˆ</th>
              <th>í† </th>
            </tr>
          </thead>
          <tbody id="calendar-body"></tbody>
        </table>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card schedule-card">
        <!-- ìš°ì¸¡ ì˜ì—­ ë‚´ìš© -->

  
  <!-- ğŸ“Œ ê°€ìš´ë° ì •ë ¬ ë²”ë¡€ -->

    <!-- íƒ­ ë©”ë‰´ -->
      <div class="tab-menu mb-3">
      <div th:each="license : ${licenseList}">
            <!-- <h5><span class="exam-title" th:text="${license.liName}" >ADP</span></h5> -->
          </div>
        <button class="active" onclick="showTab(event, 'apply')">ì ‘ìˆ˜</button>
        <button class="exam" onclick="showTab(event, 'exam')">ì‹œí—˜</button>
        <button class="result" onclick="showTab(event, 'result')">ê²°ê³¼ë°œí‘œ</button>
      </div>


    <!-- íƒ­ ì½˜í…ì¸  -->
    <div class="card-body" >

      <!-- ì ‘ìˆ˜ íƒ­ -->
      <div id="apply" class="tab-content" >
        <div class="exam-item" th:each="exam : ${exams}" >
          <div th:each="license : ${licenseList}">
          </div>
          <div class="exam-date">
            <span th:text="${#temporals.format(exam.appStd, 'yyyy-MM-dd (E)')}">2025-07-07</span> ~
            <span th:text="${#temporals.format(exam.appEd, 'yyyy-MM-dd (E)')}">2025-07-11</span>
          </div>
          
        </div>
      </div>

      <!-- ì‹œí—˜ íƒ­ -->
      <div id="exam" class="tab-content" style="display: none;">
        <div class="exam-item" th:each="exam : ${exams}" >
          <div th:each="license : ${licenseList}">
          </div>
          <div class="exam-date">
            <span th:text="${#temporals.format(exam.exStd, 'yyyy-MM-dd (E)')}">2025-07-07</span> ~
            <span th:text="${#temporals.format(exam.exEd, 'yyyy-MM-dd (E)')}">2025-07-11</span>
          </div>
        </div>
      </div>


      <!-- ê²°ê³¼ë°œí‘œ íƒ­ -->
      <div id="result" class="tab-content" style="display: none;">
        <div class="exam-item" th:each="exam : ${exams}" >
          <div th:each="license : ${licenseList}">
          <div class="day-circle exam-period-bar" th:attr="data-liname=${license.liName}"></div>
          </div>
          <div class="exam-date">
            <span th:text="${#temporals.format(exam.exRd, 'yyyy-MM-dd (E)')}">2025-07-07</span> 
          </div></div>
        </div>
      </div>

    </div>
  </div>
</div>
</div>

<!-- Footer -->
<footer class="footer mt-5 py-4 border-top">
  <div class="container text-center">
    <nav class="nav justify-content-center mb-3">
      <a href="#" class="footer-link">Home</a>
      <a href="#" class="footer-link">About</a>
      <a href="#" class="footer-link">Contact</a>
    </nav>
    <p class="text-muted small mb-0">Â© 2025 ë¬¸ì œ Issue!</p>
  </div>
</footer>


  <!-- Script -->
 <script th:inline="javascript">
   $(document).ready(function(){
      // ready() : html ì½”ë“œê°€ ì¤€ë¹„ê°€ ë˜ë©´ ì‹¤í–‰ë˜ëŠ” ë©”ì†Œë“œ
      loadTopic();
      topicRank();
      loadTopList();
      loadSubjectScore();
   });
   const today = new Date();
   const formattedToday = `${today.getFullYear()}ë…„ ${String(today.getMonth() + 1).padStart(2, '0')}ì›” ${String(today.getDate()).padStart(2, '0')}ì¼`;

   /* ì‹œí—˜ ì¼ì • ë°•ìŠ¤ */
   // showTab í•¨ìˆ˜ì—ì„œ event ì¸ìë¥¼ ë°›ì•„ì„œ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
  function showTab(event, tabId) {
    // íƒ­ ì»¨í…ì¸  ì „ë¶€ ìˆ¨ê¹€
    document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
    // ì„ íƒí•œ íƒ­ë§Œ í‘œì‹œ
    document.getElementById(tabId).style.display = 'block';

    // íƒ­ ë©”ë‰´ í™œì„±í™” í‘œì‹œ
    document.querySelectorAll('.tab-menu button').forEach(btn => btn.classList.remove('active'));
    event.currentTarget.classList.add('active');
  }
   
   
 // í† í”½ ë¦¬ìŠ¤íŠ¸
 const topicList = /*[[${topicList}]]*/ [];
 
 
 function loadTopic() {
    

      let Name = [];

       listHtml = "";
       listHtml = "<option value='default' disabled selected hidden>ìœ í˜• ì„ íƒ</option>";
       
       for (let i = 0; i < topicList.length; i++) {
            let parts = topicList[i].topicName.split(" - ");
            Name.push(parts[0]);
          }
       
       for(let i=0; i<topicList.length; i++){
          // í† í”½ ì£¼ì œ         
          listHtml += "<option id='topic"+topicList[i].topicIdx+"' value='"+ topicList[i].topicIdx + "'>"+ topicList[i].topicChap + "-" + topicList[i].topicNum+". " + Name[i] + "</option>";


       }
       $("#topic-category").html(listHtml);   
       
 }
 
 function topicRank(){
	 
	 const topicRank = /*[[${topicRank}]]*/ [];
	 
	 for(let i=0; i<topicRank.length; i++){
		 
		 console.log("í† í”½ "+topicRank[i][2]+"ë²ˆ ë¬¸ì œ ìˆ˜: "+topicRank[i][5]);
		 $("#topic"+topicRank[i][0]).css("font-weight",(topicRank[i][5]*10));
	 }
	 
 }
 
 function loadTopList(){
	 // top5[0]ì€ ì¹´ìš´íŠ¸, top5[1]ì€ topic_idx
	 const top5List = /*[[${top5List}]]*/ [];
	 let Name = [];
	 
	 listHtml = "";
	 
     for (let i = 0; i < topicList.length; i++) {
         let parts = topicList[i].topicName.split(" - ");
         Name.push(parts[0]);
       }
     
     for(let i=0; i<top5List.length; i++){
    	 for(let j=0; j<topicList.length; j++){
			if( top5List[i][1] == topicList[j].topicIdx){
				
	        /*  listHtml += "<div class='badge bg-light text-dark px-3 py-2 border rounded-pill'>" + "Top" + (i+1) + " " + topicList[j].topicNum + ". " + Name[j] + "</div>"; */
	         $("#topic"+top5List[i][1]).val();
	         
			}
    	 }
      }
     
	 // $("#top5").html(listHtml);
 	if(top5List[0] == null ){
		listHtml = "";
		
		listHtml += "<img src='images/problem.png' style='width:50%; height:50%;' />"
		
		$("#topicChartMessage").html(listHtml);	
		$("#topicChartMessage").css("display","block");
	}else{
		$("#topicChartDiv").css("display","block");
	     let topicChart = new Chart(document.getElementById("topicChart"), {
	    	  type: 'bar',
	    	  data: {
	    	    labels: [Name[0], Name[1], Name[2], Name[3], Name[4]],
	    	    datasets: [{
	    	      label: 'ì˜¤ë‹µë¥  (%)',
	    	      data: [top5List[0][0], top5List[1][0], top5List[2][0], top5List[3][0], top5List[4][0]],
	    	      backgroundColor: [
	    	        '#1E88E5', '#42A5F5', '#64B5F6', '#90CAF9', '#BBDEFB'
	    	      ],
	    	      borderRadius: 8,
	    	      barThickness: 36
	    	    }]
	    	  },
	    	  options: {
	    	    responsive: true,
	    	    plugins: {
	    	      legend: {
	    	        display: true,
	    	        position: 'top',
	    	        labels: {
	    	          color: '#333',
	    	          font: { size: 15, weight: 'bold' }
	    	        }
	    	      },
	    	      tooltip: {
	    	        callbacks: {
	    	          label: function(ctx) {
	    	            return `ì˜¤ë‹µë¥ : ${ctx.parsed.y}%`;
	    	          }
	    	        }
	    	      }
	    	    },
	    	    scales: {
	    	      x: {
	    	        ticks: { color: '#333', font: { size: 13 } },
	    	        grid: { display: false }
	    	      },
	    	      y: {
	    	        beginAtZero: true,
	    	        max: 20,
	    	        ticks: {
	    	          stepSize: 2,
	    	          color: '#333',
	    	          font: { size: 14 }
	    	        },
	    	        grid: {
	    	          color: '#e0e0e0',
	    	          drawBorder: false
	    	        }
	    	      }
	    	    }
	    	  }
	    	});
	 
 	}
 }
 function loadSubjectScore() {
 	    const subjectScore = /*[[${subjectScore}]]*/ [];
 	    const licenseList = /*[[${licenseList[0]}]]*/ {};
 	    
 	    let name = [];
 	    for (let i = 1; i <= 6; i++) {
 	        if (licenseList["liChap" + i] != null) {
 	            name.push(licenseList["liChap" + i]);
 	        }
 	    }

 	    // íšŒì°¨ í™•ì¸ì„ ìœ„í•¨.
 	    let Round = 0;

 	    let listHtml = "";	// âœ… ë°˜ë“œì‹œ letìœ¼ë¡œ ì„ ì–¸

 	    // í•œë²ˆë„ ì•ˆí’€ì—ˆë‹¤ë©´ nullê°’ì´ë¯€ë¡œ
 	    if(subjectScore[0] == null){
 	        listHtml += "<img src='images/problem.png' style='width:50%; height:50%;' />"
 	    } else {		
 	        for(let i = 0; i < subjectScore.length; i++){
 	            if(subjectScore[i] != null && i < 3){
 	                Round += 1;
 	            }
 	        }

 	        listHtml += `
 	            <div style="overflow-x: auto; margin-top:25px;">
 	              <table style="
 	                width: 100%;
 	                border-collapse: separate;
 	                border-spacing: 0;
 	                margin-top: 20px;
 	                font-size: 15px;
 	                border-radius: 12px;
 	                overflow: hidden;
 	                table-layout: fixed;
 	                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
 	              ">
 	                <thead>
 	                  <tr style="background-color: #f0f4f9; color: #1e1e1e;">
 	                    <th style="width: 130px; padding: 14px; text-align: center; white-space: nowrap; font-weight: 600; border-bottom: 2px solid #e0e0e0;">ì‹œí—˜ë‚ ì§œ</th>`;

 	        // âœ… ê³¼ëª©ëª…ì€ name ë°°ì—´ì„ ì‚¬ìš©í•´ì•¼ ì˜¤ë¥˜ ì—†ìŒ
 	        for (let i = 0; i < name.length; i++) {
 	            listHtml += `<th style="padding: 14px; text-align: center; font-weight: 600; border-bottom: 2px solid #e0e0e0;">${name[i]}</th>`;
 	        }

 	        listHtml += `<th style="padding: 14px; text-align: center; font-weight: 600; border-bottom: 2px solid #e0e0e0; white-space: nowrap;">ì´í•©</th>`;
 	        listHtml += `</tr></thead><tbody>`;

 	        for (let i = 0; i < subjectScore.length && i < 3; i++) {
 	            let total = 0;
 	            listHtml += `<tr style="background-color: ${i % 2 === 0 ? '#ffffff' : '#f5faff'};">`;
 	            listHtml += `<td style="padding: 14px; text-align: center; color: #333;">${subjectScore[i].scAt.split("T")[0]}</td>`;

 	            for (let j = 1; j <= name.length; j++) {
 	                // âœ… ê³¼ëª© ì ìˆ˜ ëˆ„ì 
 	                const val = subjectScore[i]["scChap" + j] || 0;
 	                total += val;
 	                listHtml += `<td style="padding: 14px; text-align: center; color: #333;">${val}</td>`;
 	            }

 	            listHtml += `<td style="padding: 14px; text-align: center; font-weight: bold; color: #1E88E5; background-color: #e3f2fd;">${total}</td>`;
 	            listHtml += `</tr>`;
 	        }

 	        listHtml += `</tbody></table></div>`;
 	    }

 	    $("#subjectScore").html(listHtml);
 	}

 
 
 // ì‹œí—˜ ì •ë³´
  const examPeriods = /*[[${exams}]]*/ [];

  const examDates = [];  // ê¸°ì¡´ê³¼ ë™ì¼

  examPeriods.forEach(exam => {
    // âœ… ì ‘ìˆ˜ ê¸°ê°„: appStd ~ appEd
    if (exam.appStd && exam.appEd) {
      let d = new Date(exam.appStd);
      const end = new Date(exam.appEd);
      while (d <= end) {
        examDates.push({ date: dateToString(d), type: "apply" });
        d.setDate(d.getDate() + 1);
      }
    }

    // âœ… ì‹œí—˜ ê¸°ê°„: exStd ~ exEd
    if (exam.exStd && exam.exEd) {
      let d = new Date(exam.exStd);
      const end = new Date(exam.exEd);
      while (d <= end) {
        examDates.push({ date: dateToString(d), type: "exam" });
        d.setDate(d.getDate() + 1);
      }
    }

    // âœ… ê²°ê³¼ ë°œí‘œì¼
    if (exam.exRd) {
      examDates.push({ date: dateToString(new Date(exam.exRd)), type: "result" });
    }
  });

  function dateToString(d) {
    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
  }

  // calendarBody: ë‹¬ë ¥ í…Œì´ë¸”(<tbody>)ì„ ë„£ì„ ìœ„ì¹˜
  const calendarBody = document.getElementById("calendar-body");
  
  // monthYear: "2025ë…„ 6ì›”" ë“± ë‹¬ë ¥ ìƒë‹¨ íƒ€ì´í‹€
  const monthYear = document.getElementById("month-year");
    
  const checkAttendanceBtn = document.getElementById("check-attendance");
    
  // currentDate: í˜„ì¬ ê¸°ì¤€ ë‹¬ë ¥ ë‚ ì§œ
  let currentDate = new Date();
  
  // attendanceDates: ì¶œì„ì²´í¬ ëœ ë‚ ì§œë“¤ (ë‚˜ì¤‘ì— ì„œë²„ì—ì„œ ë°›ì•„ì˜¬ ìˆ˜ë„ ìˆìŒ)
  let attendanceDates = JSON.parse('[[${date}]]'); // ì¶œì„í•œ ë‚ ì§œ ì €ì¥ìš© ë°°ì—´
  renderCalendar(currentDate);  // í˜ì´ì§€ ë¡œë“œì‹œ ë‹¬ë ¥ ë Œë”ë§
  
  // ë‚ ì§œ í•¨ìˆ˜ 2ìë¦¬ ìˆ˜ë¡œ ë³€ê²½ ex 2025-6-6 -> 2025-06-06
  function pad(n) {
     return n < 10 ? "0" + n : n;
   }

  // ë‹¬ë ¥ì„ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  function renderCalendar(date) {
    calendarBody.innerHTML = ""; // ê¸°ì¡´ ë‹¬ë ¥ ì´ˆê¸°í™”
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1).getDay(); // 1ì¼ì˜ ìš”ì¼ (0=ì¼, 6=í† )
    const lastDate = new Date(year, month + 1, 0).getDate(); // ì›”ì˜ ë§ˆì§€ë§‰ ì¼
    const today = new Date();

    monthYear.textContent = `ğŸ“… ${year}ë…„ ${month + 1}ì›”`;

    // 6ì£¼ Ã— 7ì¼ ë‹¬ë ¥ ë§Œë“¤ê¸° ( í•œ ë‹¬ì€ ìµœëŒ€ 6ì£¼ê¹Œì§€ ìˆì–´ì„œ )
    let day = 1;
    for (let i = 0; i < 6; i++) {
      const row = document.createElement("tr");
      for (let j = 0; j < 7; j++) {
        const cell = document.createElement("td");

        
        // ì²« ì£¼(i==0)ì—ì„œ firstDay ì´ì „ì—ëŠ” ë¹ˆì¹¸
        // day > lastDateë©´ ì›”ì´ ëë‚¬ìœ¼ë¯€ë¡œ ë¹ˆì¹¸
        if (i === 0 && j < firstDay || day > lastDate) {
          cell.innerHTML = "";
        } else {
          const thisDate = new Date(year, month, day);
          const dateStr = `${year}-${pad(month + 1)}-${pad(day)}`;
          const dayCircle = document.createElement("div");
          
          dayCircle.classList.add("day-circle");
          dayCircle.textContent = day;

            // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
          if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
            dayCircle.classList.add("today");
          }
          // ì¼ìš”ì¼ ìŠ¤íƒ€ì¼
          if (j === 0) {
            cell.classList.add("sunday");
          }

          // ì¶œì„í•œ ë‚ ì§œ(dateStr)ëŠ” í‘œì‹œ
          if (attendanceDates.includes(dateStr)) {
            dayCircle.classList.add("attended");
          }
          
          /* ë‹¬ë ¥ì— ì¼ì • í‘œì‹œ */
          const exam = examDates.find(e => e.date === dateStr);
         if (exam ) {
           dayCircle.classList.add("exam-period-bar");
           dayCircle.classList.add(`exam-period-${exam.type}`); // ì¶”ê°€ëœ íƒ€ì…ë³„ í´ë˜ìŠ¤
         }
         

          // í˜„ì¬ ì…€ì— í•´ë‹¹ ë‚ ì§œë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤„ div.day-circleì„ ì‚½ì…í•˜ëŠ” ì—­í• 
          cell.appendChild(dayCircle);
          day++;
        }

        // í˜„ì¬ tr ì¤„ì— td í•˜ë‚˜ë¥¼ ì¶”ê°€
        row.appendChild(cell);
      }
      calendarBody.appendChild(row);
      if (day > lastDate) break; // ë‹¤ ì±„ìš°ë©´ ë£¨í”„ íƒˆì¶œ
    }
  }

  
  function changeMonth(step) {
    currentDate.setMonth(currentDate.getMonth() + step);
    renderCalendar(currentDate);
    
  }

  checkAttendanceBtn.addEventListener("click", () => {
     const id = $("#id").val();

     $.ajax({
       url: "/atd_check",
       type: "post",
       dataType: "text",
       data: { id: id },
       success: function (response) {
         if (response === "true") { // ì‘ë‹µì´ Trueì¼ ê²½ìš°
           alert("ì¶œì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");

           // ì—¬ê¸°ì„œë¶€í„° elseì „ê¹Œì§€ ì „ë¶€ ë™ê·¸ë¼ë¯¸ í‘œì‹œ ì˜ì—­
           const today = new Date();
           console.log(today);
           // ë…„,ì›”,ì¼ ë¬¸ìì—´ í‘œì‹œ - ex) "2025-06-06" / MonthëŠ” 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
           const dateStr = `${today.getFullYear()}-${pad(today.getMonth() + 1)}-${pad(today.getDate())}`;
           if (!attendanceDates.includes(dateStr)) {
             attendanceDates.push(dateStr);
           }

           renderCalendar(currentDate); // ë‹¤ì‹œ ë Œë”ë§
         } else {
           alert("ì´ë¯¸ ì¶œì„í•˜ì…¨ìŠµë‹ˆë‹¤!");
           
         }
       },
       error: function () {
         alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
       }
     });
   });
  renderCalendar(currentDate);
 
 
</script>
</body>
</html>