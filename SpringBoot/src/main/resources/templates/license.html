<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org/">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LICENSE</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <!-- Main Style -->
  <link href="/css/style.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

  <!-- Header -->
   <input type="hidden" id="id" th:value="${member.id}" />
   
  <nav class="custom-header">
    <div class="container d-flex justify-content-between align-items-center">
      <div class="logo d-flex align-items-center gap-2">
      	<a href="/">
        <img src="/images/ë¡œê³ .png" height="40" alt="ë¡œê³ ">
        <span class="logo-text"></span>
      	</a>
      </div>
      <div class="header-links d-flex gap-2">
        <button class="btn btn-outline-secondary" >MYPAGE</button>
        <button class="btn btn-outline-danger" >LOGOUT</button>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <div class="container mt-5">
    <h4 class="text-center mb-5">
	  <span th:text="${member.name} + 'ë‹˜! ì‹œí—˜ê¹Œì§€ '"></span>
	  <strong>00ì¼</strong>
	  <span> ë‚¨ì•˜ì–´ìš”~</span>
    </h4>

    <div class="row">
      <!-- Left Column -->
      <div class="col-md-8 d-flex flex-column gap-4">

        <!-- ê¸°ì¶œ í’€ê¸° -->
        <div class="dashboard-card p-4">
          <h5 class="fw-bold mb-4">ê¸°ì¶œ í’€ê¸°</h5>
          <form id="examForm" method="post" class="d-flex align-items-center gap-2">
            <div class="flex-grow-1" style="width:300px; padding-left: 100px;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <select name="category" class="form-control rounded-pill px-4 py-2">
                <option value="" disabled selected hidden>íšŒì°¨ ê²€ìƒ‰</option>
                <option value="1">2020-06-06</option>
                <option value="2">2020-08-22</option>
                <option value="3">2020-09-26</option>
                <option value="4">2021-03-07</option>
                <option value="5">2021-05-15</option>
                <option value="6">2021-08-14</option>
                <option value="7">2022-03-05</option>
                <option value="8">2022-04-24</option>
              </select>
            </div>
            <button class="btn btn-light" type="submit" onclick="submitForm('goExam.do')">ì‹œí—˜</button>
            <button style="margin-right:50px;" class="btn btn-light" type="submit" onclick="submitForm('goTest.do')">ì—°ìŠµ</button>
          </form>
        </div>

        <!-- ì£¼ì œë³„ í•™ìŠµí•˜ê¸° -->
        <div class="dashboard-card p-4">
		  <h5 class="fw-bold mb-4">ì£¼ì œë³„ í•™ìŠµí•˜ê¸°</h5>
		  <form action="goTypeList.do" method="post" class="d-flex align-items-center gap-2" style="padding-left: 100px;">
		    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
		    
		    <select name="category" class="form-control rounded-pill px-4 py-2" style="width: 600px;">
		      <option value="" disabled selected hidden>ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
		      <option value="101">1</option>
		      <option value="102">2</option>
		      <option value="103">3</option>
		      <option value="104">4</option>
		      <option value="105">5</option>
		      <option value="106">6</option>
		      <option value="107">7</option>
		      <option value="108">8</option>
		      <option value="109">9</option>
		      <option value="110">10</option>
		    </select>
		
		    <button class="btn btn-light" type="submit" style="width: 42px; height: 42px;">
		      <i class="bi bi-search"></i>
		    </button>
		  </form>
		</div>

      </div>

      <!-- Right Column -->
      <div class="col-md-4">
        <div class="dashboard-card p-4" style="height: 350px;">
          <h5 class="fw-bold mb-3" th:text="${member.name} + 'ë‹˜ì˜ ì£¼ì œë³„ ì˜¤ë‹µ TOP 5'"></h5>
          <canvas id="wrongChart" height="250"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Calendar & Schedule -->
  <div class="container mb-5">
    <div class="row">
      <div class="col-md-8 mb-4">
        <div class="calendar-box">
          <h4>
            <button class="btn btn-outline-secondary btn-sm me-2" onclick="changeMonth(-1)">â†</button>
            <span id="month-year"></span>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="changeMonth(1)">â†’</button>
            <button class="btn btn-primary rounded-pill px-3" type="button" 
            id="check-attendance" style="margin-left: 565px">ì¶œì„</button>
            
          </h4>
          <table>
            <thead>
              <tr>
                <th style="color: red;">ì¼</th>
                <th>ì›”</th>
                <th>í™”</th>
                <th>ìˆ˜</th>
                <th>ëª©</th>
                <th>ê¸ˆ</th>
                <th>í† </th>
              </tr>
            </thead>
            <tbody id="calendar-body"></tbody>
          </table>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card schedule-card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>ğŸ“Œ ì ‘ìˆ˜</span>
          </div>
          <div class="card-body">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="container">
    <footer class="py-3 my-4">
      <ul class="nav justify-content-center border-bottom pb-3 mb-3">
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
      </ul>
      <p class="text-center text-muted">Â© 2025 ë¬¸ì œ Issue!</p>
    </footer>
  </div>

  <!-- Script -->
  <script th:inline="javascript">
  

  
  function submitForm(actionUrl) {
      const form = document.getElementById("examForm");
      console.log("formê°’: "+ form);
      form.action = actionUrl;
      form.submit();
    }
  
  // calendarBody: ë‹¬ë ¥ í…Œì´ë¸”(<tbody>)ì„ ë„£ì„ ìœ„ì¹˜
  const calendarBody = document.getElementById("calendar-body");
  
  // monthYear: "2025ë…„ 6ì›”" ë“± ë‹¬ë ¥ ìƒë‹¨ íƒ€ì´í‹€
  const monthYear = document.getElementById("month-year");
    
  const checkAttendanceBtn = document.getElementById("check-attendance");
    
  // currentDate: í˜„ì¬ ê¸°ì¤€ ë‹¬ë ¥ ë‚ ì§œ
  let currentDate = new Date();
  
  // attendanceDates: ì¶œì„ì²´í¬ ëœ ë‚ ì§œë“¤ (ë‚˜ì¤‘ì— ì„œë²„ì—ì„œ ë°›ì•„ì˜¬ ìˆ˜ë„ ìˆìŒ)
  let attendanceDates = JSON.parse('[[${date}]]'); // ì¶œì„í•œ ë‚ ì§œ ì €ì¥ìš© ë°°ì—´
  renderCalendar(currentDate);  // í˜ì´ì§€ ë¡œë“œì‹œ ë‹¬ë ¥ ë Œë”ë§
  
  // ë‚ ì§œ í•¨ìˆ˜ 2ìë¦¬ ìˆ˜ë¡œ ë³€ê²½ ex 2025-6-6 -> 2025-06-06
  function pad(n) {
	  return n < 10 ? "0" + n : n;
	}

  // ë‹¬ë ¥ì„ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  function renderCalendar(date) {
    calendarBody.innerHTML = ""; // ê¸°ì¡´ ë‹¬ë ¥ ì´ˆê¸°í™”
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1).getDay(); // 1ì¼ì˜ ìš”ì¼ (0=ì¼, 6=í† )
    const lastDate = new Date(year, month + 1, 0).getDate(); // ì›”ì˜ ë§ˆì§€ë§‰ ì¼
    const today = new Date();

    monthYear.textContent = `ğŸ“… ${year}ë…„ ${month + 1}ì›”`;

    // 6ì£¼ Ã— 7ì¼ ë‹¬ë ¥ ë§Œë“¤ê¸° ( í•œ ë‹¬ì€ ìµœëŒ€ 6ì£¼ê¹Œì§€ ìˆì–´ì„œ )
    let day = 1;
    for (let i = 0; i < 6; i++) {
      const row = document.createElement("tr");
      for (let j = 0; j < 7; j++) {
        const cell = document.createElement("td");

        
        // ì²« ì£¼(i==0)ì—ì„œ firstDay ì´ì „ì—ëŠ” ë¹ˆì¹¸
        // day > lastDateë©´ ì›”ì´ ëë‚¬ìœ¼ë¯€ë¡œ ë¹ˆì¹¸
        if (i === 0 && j < firstDay || day > lastDate) {
          cell.innerHTML = "";
        } else {
          const thisDate = new Date(year, month, day);
          const dateStr = `${year}-${pad(month + 1)}-${pad(day)}`;

          const dayCircle = document.createElement("div");
          dayCircle.classList.add("day-circle");
          dayCircle.textContent = day;

       	  // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
          if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
            dayCircle.classList.add("today");
          }

          // ì¼ìš”ì¼ ìŠ¤íƒ€ì¼
          if (j === 0) {
            cell.classList.add("sunday");
          }

          // ì¶œì„í•œ ë‚ ì§œ(dateStr)ëŠ” í‘œì‹œ
          if (attendanceDates.includes(dateStr)) {
            dayCircle.classList.add("attended");
          }

          // í˜„ì¬ ì…€ì— í•´ë‹¹ ë‚ ì§œë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤„ div.day-circleì„ ì‚½ì…í•˜ëŠ” ì—­í• 
          cell.appendChild(dayCircle);
          day++;
        }

        // í˜„ì¬ tr ì¤„ì— td í•˜ë‚˜ë¥¼ ì¶”ê°€
        row.appendChild(cell);
      }
      calendarBody.appendChild(row);
      if (day > lastDate) break; // ë‹¤ ì±„ìš°ë©´ ë£¨í”„ íƒˆì¶œ
    }
  }

  
  function changeMonth(step) {
    currentDate.setMonth(currentDate.getMonth() + step);
    renderCalendar(currentDate);
    
  }

  checkAttendanceBtn.addEventListener("click", () => {
	  const id = $("#id").val();

	  $.ajax({
	    url: "/atd_check",
	    type: "post",
	    dataType: "text",
	    data: { id: id },
	    success: function (response) {
	      if (response === "true") { // ì‘ë‹µì´ Trueì¼ ê²½ìš°
	        alert("ì¶œì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");

	        // ì—¬ê¸°ì„œë¶€í„° elseì „ê¹Œì§€ ì „ë¶€ ë™ê·¸ë¼ë¯¸ í‘œì‹œ ì˜ì—­
	        const today = new Date();
	        console.log(today);
	        // ë…„,ì›”,ì¼ ë¬¸ìì—´ í‘œì‹œ - ex) "2025-06-06" / MonthëŠ” 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
	        const dateStr = `${today.getFullYear()}-${pad(today.getMonth() + 1)}-${pad(today.getDate())}`;
	        if (!attendanceDates.includes(dateStr)) {
	          attendanceDates.push(dateStr);
	        }

	        renderCalendar(currentDate); // ë‹¤ì‹œ ë Œë”ë§
	      } else {
	        alert("ì´ë¯¸ ì¶œì„í•˜ì…¨ìŠµë‹ˆë‹¤!");
	        
	      }
	    },
	    error: function () {
	      alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	    }
	  });
	});
	


  renderCalendar(currentDate);

</script>


</body>

</html>